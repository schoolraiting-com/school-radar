{{ define "main" }}
<article class="container content-page school-page">

  <!-- Breadcrumbs (мелкие, приглушённые) -->
  <nav class="breadcrumbs" aria-label="Навигация">
    <a href="/">Главная</a>
    <span class="bc-sep">/</span>
    <a href="/schools/">Школы</a>
    <span class="bc-sep">/</span>
    <span>{{ .Params.school_name | default .Title }}</span>
  </nav>

  <!-- EEAT: автор + дата публикации -->
  <div class="eeat-block">
    <div class="eeat-author">
      <div class="eeat-avatar">SR</div>
      <div>
        <span class="eeat-name">Команда School Radar</span>
        <span class="eeat-role">Независимая редакция</span>
      </div>
    </div>
    <div class="eeat-meta">
      <span>Опубликовано: {{ .Date.Format "02.01.2006" }}</span>
      {{ with .Params.updated }}<span>Обновлено: {{ . }}</span>{{ end }}
    </div>
  </div>

  <!-- Hero: логотип + название + рейтинг + CTA -->
  <div class="school-hero">
    <div class="school-hero-title-row">
      <div class="school-logo-placeholder">
        {{ with .Params.logo }}
        <img src="{{ . }}" alt="{{ $.Params.school_name }}">
        {{ else }}
        <div class="logo-stub"></div>
        {{ end }}
      </div>
      <h1>{{ .Params.school_name | default .Title }}</h1>
    </div>
    {{ with .Params.tagline }}<p class="school-tagline">{{ . }}</p>{{ end }}

    <!-- Рейтинг с пояснением -->
    {{ with .Params.rating }}
    <div class="rating-block">
      <div class="rating-score">
        <span class="rating-number">{{ . }}</span>
        <span class="rating-max">/10</span>
      </div>
      <div class="rating-details">
        <div class="rating-stars">{{ partial "stars.html" (dict "rating" .) }}</div>
        <span class="rating-source">На основе отзывов пользователей и оценок на Отзовик, IRecommend, Trustpilot</span>
      </div>
    </div>
    {{ end }}

    {{ with .Params.affiliate_url }}
    <a href="{{ . }}" target="_blank" rel="nofollow sponsored" class="cta-button cta-button-full">Попробовать бесплатно →</a>
    {{ end }}
  </div>

  <!-- Быстрые плюсы и минусы -->
  {{ if or .Params.quick_pros .Params.quick_cons }}
  <div class="quick-verdict">
    <div class="qv-pros">
      <h3 class="qv-title qv-title-pro">Плюсы</h3>
      <ul>
        {{ range .Params.quick_pros }}<li>{{ . }}</li>{{ end }}
      </ul>
    </div>
    <div class="qv-cons">
      <h3 class="qv-title qv-title-con">Минусы</h3>
      <ul>
        {{ range .Params.quick_cons }}<li>{{ . }}</li>{{ end }}
      </ul>
    </div>
  </div>
  {{ end }}

  <!-- Quick facts -->
  {{ with .Params.facts }}
  <div class="quick-facts">
    {{ with .age }}<div class="fact"><span class="fact-label">Возраст</span><span class="fact-value">{{ . }}</span></div>{{ end }}
    {{ with .price }}<div class="fact"><span class="fact-label">Цена</span><span class="fact-value">от {{ . }}</span></div>{{ end }}
    {{ with .trial }}<div class="fact"><span class="fact-label">Пробный урок</span><span class="fact-value">{{ . }}</span></div>{{ end }}
    {{ with .format }}<div class="fact"><span class="fact-label">Формат</span><span class="fact-value">{{ . }}</span></div>{{ end }}
    {{ with .subjects }}<div class="fact"><span class="fact-label">Направления</span><span class="fact-value">{{ . }}</span></div>{{ end }}
  </div>
  {{ end }}

  <!-- Содержание -->
  <div class="toc-block">
    <strong>Содержание:</strong>
    <ul>
      <li><a href="#about">О школе</a></li>
      <li><a href="#programs">Программы</a></li>
      <li><a href="#prices">Цены</a></li>
      <li><a href="#pros-cons">Плюсы и минусы</a></li>
      <li><a href="#format">Формат занятий</a></li>
      <li><a href="#reviews">Отзывы</a></li>
      <li><a href="#faq">Частые вопросы</a></li>
      <li><a href="#verdict">Наш вердикт</a></li>
    </ul>
  </div>

  <!-- Main content (markdown) -->
  {{ .Content }}

  <!-- ===== INTERLINKING BLOCKS ===== -->

  <!-- Promo link -->
  {{ with .Params.promo_url }}
  <div class="interlink-box interlink-promo">
    <div class="interlink-box-content">
      <strong>Промокоды и скидки {{ $.Params.school_name }}</strong>
      <p>Актуальные промокоды и акции этой школы</p>
    </div>
    <a href="{{ . }}" class="btn-outline">Смотреть промокоды →</a>
  </div>
  {{ end }}

  <!-- Compare links -->
  {{ with .Params.comparisons }}
  <div class="interlink-section">
    <h2>Сравнение с другими школами</h2>
    <div class="interlink-grid">
      {{ range . }}
      <a href="{{ .url }}" class="interlink-card">
        <strong>{{ .title }}</strong>
        <span class="interlink-arrow">→</span>
      </a>
      {{ end }}
    </div>
  </div>
  {{ end }}

  <!-- Rating links -->
  {{ with .Params.in_ratings }}
  <div class="interlink-section">
    <h2>{{ $.Params.school_name }} в рейтингах</h2>
    <div class="interlink-grid">
      {{ range . }}
      <a href="{{ .url }}" class="interlink-card">
        <span class="interlink-position">#{{ .position }}</span>
        <strong>{{ .title }}</strong>
        <span class="interlink-arrow">→</span>
      </a>
      {{ end }}
    </div>
  </div>
  {{ end }}

  <!-- Related blog posts -->
  {{ with .Params.related_posts }}
  <div class="interlink-section">
    <h2>Полезные статьи</h2>
    <div class="interlink-grid">
      {{ range . }}
      <a href="{{ .url }}" class="interlink-card">
        <strong>{{ .title }}</strong>
        <span class="interlink-arrow">→</span>
      </a>
      {{ end }}
    </div>
  </div>
  {{ end }}

  <!-- Final CTA -->
  {{ with .Params.affiliate_url }}
  <div class="cta-box">
    <h3>Попробуйте {{ $.Params.school_name }} бесплатно</h3>
    <p>Запишитесь на пробный урок и оцените школу сами</p>
    <a href="{{ . }}" target="_blank" rel="nofollow sponsored" class="cta-button">Записаться на пробный урок →</a>
  </div>
  {{ end }}

  <!-- EEAT: автор внизу -->
  <div class="eeat-block eeat-bottom">
    <div class="eeat-author">
      <div class="eeat-avatar">SR</div>
      <div>
        <span class="eeat-name">Команда School Radar</span>
        <p class="eeat-bio">Независимая редакция School Radar анализирует онлайн-школы на основе открытых данных, отзывов пользователей и собственного тестирования. Мы не принимаем оплату за позиции в рейтингах.</p>
      </div>
    </div>
  </div>

</article>

<!-- Schema.org Review -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Review",
  "itemReviewed": {
    "@type": "EducationalOrganization",
    "name": "{{ .Params.school_name | default .Title }}"
  },
  "reviewRating": {
    "@type": "Rating",
    "ratingValue": "{{ .Params.rating }}",
    "bestRating": "10"
  },
  "author": {
    "@type": "Organization",
    "name": "School Radar"
  },
  "publisher": {
    "@type": "Organization",
    "name": "School Radar"
  },
  "datePublished": "{{ .Date.Format "2006-01-02" }}",
  "dateModified": "{{ with .Params.updated }}{{ . }}{{ else }}{{ .Date.Format "2006-01-02" }}{{ end }}"
}
</script>

{{ if .Params.faq }}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {{ range $i, $item := .Params.faq }}
    {{ if $i }},{{ end }}
    {
      "@type": "Question",
      "name": "{{ $item.q }}",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "{{ $item.a }}"
      }
    }
    {{ end }}
  ]
}
</script>
{{ end }}

{{ end }}
